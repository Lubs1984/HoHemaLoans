{
  "version": "7.3",
  "data_api_version": "3.0",
  "routing_model": {
    "LOAN_AMOUNT": ["TERM_MONTHS"],
    "TERM_MONTHS": ["LOAN_PURPOSE"],
    "LOAN_PURPOSE": ["AFFORDABILITY_CHECK"],
    "AFFORDABILITY_CHECK": ["TERMS_PREVIEW"],
    "TERMS_PREVIEW": ["BANK_DETAILS"],
    "BANK_DETAILS": ["CONFIRM_SUBMIT"],
    "CONFIRM_SUBMIT": ["SUCCESS"],
    "SUCCESS": []
  },
  "screens": [
    {
      "id": "LOAN_AMOUNT",
      "title": "Loan Amount",
      "data": {
        "min_amount": {
          "type": "number",
          "__example__": 500
        },
        "max_amount": {
          "type": "number",
          "__example__": 50000
        }
      },
      "layout": {
        "type": "SingleColumnLayout",
        "children": [
          {
            "type": "Form",
            "name": "loan_amount_form",
            "children": [
              {
                "type": "TextHeading",
                "text": "How much do you need?"
              },
              {
                "type": "TextSubheading",
                "text": "Select your desired loan amount"
              },
              {
                "type": "TextInput",
                "name": "loan_amount",
                "label": "Loan Amount (R)",
                "input-type": "number",
                "required": true,
                "helper-text": "Minimum R${data.min_amount} - Maximum R${data.max_amount}"
              },
              {
                "type": "TextCaption",
                "text": "üí° Your monthly payment will be calculated on the next step"
              },
              {
                "type": "Footer",
                "label": "Continue",
                "on-click-action": {
                  "name": "complete",
                  "payload": {
                    "loan_amount": "${form.loan_amount}",
                    "screen": "LOAN_AMOUNT"
                  }
                }
              }
            ]
          }
        ]
      }
    },
    {
      "id": "TERM_MONTHS",
      "title": "Repayment Term",
      "data": {
        "term_options": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": { "type": "string" },
              "months": { "type": "number" },
              "monthly_payment": { "type": "string" }
            }
          },
          "__example__": [
            { "id": "6", "months": 6, "monthly_payment": "R875" },
            { "id": "12", "months": 12, "monthly_payment": "R458" },
            { "id": "24", "months": 24, "monthly_payment": "R242" },
            { "id": "36", "months": 36, "monthly_payment": "R171" }
          ]
        }
      },
      "layout": {
        "type": "SingleColumnLayout",
        "children": [
          {
            "type": "Form",
            "name": "term_form",
            "children": [
              {
                "type": "TextHeading",
                "text": "Select Repayment Period"
              },
              {
                "type": "TextSubheading",
                "text": "Choose how long you'd like to repay the loan"
              },
              {
                "type": "RadioButtonsGroup",
                "name": "term_months",
                "label": "Repayment Term",
                "required": true,
                "data-source": "${data.term_options}",
                "on-select-action": {
                  "name": "data_exchange",
                  "payload": {
                    "selected_term": "${form.term_months}"
                  }
                }
              },
              {
                "type": "Footer",
                "label": "Continue",
                "on-click-action": {
                  "name": "complete",
                  "payload": {
                    "term_months": "${form.term_months}",
                    "screen": "TERM_MONTHS"
                  }
                }
              }
            ]
          }
        ]
      }
    },
    {
      "id": "LOAN_PURPOSE",
      "title": "Loan Purpose",
      "data": {
        "purposes": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": { "type": "string" },
              "title": { "type": "string" }
            }
          },
          "__example__": [
            { "id": "emergency", "title": "üö® Emergency" },
            { "id": "education", "title": "üìö Education" },
            { "id": "medical", "title": "‚öïÔ∏è Medical" },
            { "id": "home", "title": "üè† Home Improvement" },
            { "id": "debt", "title": "üí≥ Debt Consolidation" },
            { "id": "other", "title": "üìù Other" }
          ]
        }
      },
      "layout": {
        "type": "SingleColumnLayout",
        "children": [
          {
            "type": "Form",
            "name": "purpose_form",
            "children": [
              {
                "type": "TextHeading",
                "text": "What is the loan for?"
              },
              {
                "type": "RadioButtonsGroup",
                "name": "loan_purpose",
                "label": "Loan Purpose",
                "required": true,
                "data-source": "${data.purposes}"
              },
              {
                "type": "TextInput",
                "name": "purpose_description",
                "label": "Additional Details (Optional)",
                "input-type": "text",
                "required": false,
                "helper-text": "Provide more information about your loan purpose"
              },
              {
                "type": "Footer",
                "label": "Continue",
                "on-click-action": {
                  "name": "complete",
                  "payload": {
                    "loan_purpose": "${form.loan_purpose}",
                    "purpose_description": "${form.purpose_description}",
                    "screen": "LOAN_PURPOSE"
                  }
                }
              }
            ]
          }
        ]
      }
    },
    {
      "id": "AFFORDABILITY_CHECK",
      "title": "Affordability Check",
      "data": {
        "monthly_income": { "type": "string", "__example__": "R8,500" },
        "monthly_expenses": { "type": "string", "__example__": "R5,200" },
        "disposable_income": { "type": "string", "__example__": "R3,300" },
        "monthly_payment": { "type": "string", "__example__": "R458" },
        "can_afford": { "type": "boolean", "__example__": true }
      },
      "layout": {
        "type": "SingleColumnLayout",
        "children": [
          {
            "type": "Form",
            "name": "affordability_form",
            "children": [
              {
                "type": "TextHeading",
                "text": "Affordability Assessment"
              },
              {
                "type": "TextBody",
                "text": "Based on your financial information:"
              },
              {
                "type": "TextBody",
                "text": "üìä Monthly Income: ${data.monthly_income}"
              },
              {
                "type": "TextBody",
                "text": "üí∞ Monthly Expenses: ${data.monthly_expenses}"
              },
              {
                "type": "TextBody",
                "text": "‚úÖ Disposable Income: ${data.disposable_income}"
              },
              {
                "type": "TextBody",
                "text": "üí≥ Loan Payment: ${data.monthly_payment}/month"
              },
              {
                "type": "EmbeddedLink",
                "text": "Update my financial information",
                "on-click-action": {
                  "name": "navigate",
                  "next": {
                    "type": "external_link",
                    "url": "https://hohemaweb-development.up.railway.app/affordability"
                  }
                }
              },
              {
                "type": "Footer",
                "label": "Continue",
                "on-click-action": {
                  "name": "complete",
                  "payload": {
                    "affordability_checked": true,
                    "screen": "AFFORDABILITY_CHECK"
                  }
                }
              }
            ]
          }
        ]
      }
    },
    {
      "id": "TERMS_PREVIEW",
      "title": "Loan Terms",
      "data": {
        "loan_amount": { "type": "string", "__example__": "R5,000" },
        "term_months": { "type": "number", "__example__": 12 },
        "interest_rate": { "type": "string", "__example__": "5%" },
        "monthly_payment": { "type": "string", "__example__": "R458" },
        "total_interest": { "type": "string", "__example__": "R496" },
        "total_amount": { "type": "string", "__example__": "R5,496" }
      },
      "layout": {
        "type": "SingleColumnLayout",
        "children": [
          {
            "type": "Form",
            "name": "terms_form",
            "children": [
              {
                "type": "TextHeading",
                "text": "Review Your Loan Terms"
              },
              {
                "type": "TextBody",
                "text": "üìã Loan Summary"
              },
              {
                "type": "TextBody",
                "text": "Amount: ${data.loan_amount}"
              },
              {
                "type": "TextBody",
                "text": "Term: ${data.term_months} months"
              },
              {
                "type": "TextBody",
                "text": "Interest Rate: ${data.interest_rate}"
              },
              {
                "type": "TextBody",
                "text": "üí≥ Monthly Payment: ${data.monthly_payment}"
              },
              {
                "type": "TextBody",
                "text": "Total Interest: ${data.total_interest}"
              },
              {
                "type": "TextBody",
                "text": "üí∞ Total Repayment: ${data.total_amount}"
              },
              {
                "type": "TextCaption",
                "text": "‚öñÔ∏è NCR Registered | Responsible Lending"
              },
              {
                "type": "Footer",
                "label": "Accept Terms",
                "on-click-action": {
                  "name": "complete",
                  "payload": {
                    "terms_accepted": true,
                    "screen": "TERMS_PREVIEW"
                  }
                }
              }
            ]
          }
        ]
      }
    },
    {
      "id": "BANK_DETAILS",
      "title": "Bank Details",
      "data": {
        "banks": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "id": { "type": "string" },
              "name": { "type": "string" }
            }
          },
          "__example__": [
            { "id": "absa", "name": "ABSA" },
            { "id": "fnb", "name": "FNB" },
            { "id": "standard_bank", "name": "Standard Bank" },
            { "id": "nedbank", "name": "Nedbank" },
            { "id": "capitec", "name": "Capitec" },
            { "id": "african_bank", "name": "African Bank" },
            { "id": "tymebank", "name": "TymeBank" },
            { "id": "discovery", "name": "Discovery Bank" },
            { "id": "investec", "name": "Investec" },
            { "id": "bidvest", "name": "Bidvest Bank" },
            { "id": "other", "name": "Other" }
          ]
        }
      },
      "layout": {
        "type": "SingleColumnLayout",
        "children": [
          {
            "type": "Form",
            "name": "bank_details_form",
            "children": [
              {
                "type": "TextHeading",
                "text": "Bank Account Details"
              },
              {
                "type": "TextSubheading",
                "text": "Where should we send your loan?"
              },
              {
                "type": "Dropdown",
                "name": "bank_name",
                "label": "Bank Name",
                "required": true,
                "data-source": "${data.banks}"
              },
              {
                "type": "TextInput",
                "name": "account_holder_name",
                "label": "Account Holder Name",
                "input-type": "text",
                "required": true,
                "helper-text": "Full name as shown on your bank account"
              },
              {
                "type": "TextInput",
                "name": "account_number",
                "label": "Account Number",
                "input-type": "number",
                "required": true,
                "helper-text": "Your bank account number (8-20 digits)"
              },
              {
                "type": "TextCaption",
                "text": "üîí Your banking information is secure and encrypted"
              },
              {
                "type": "Footer",
                "label": "Continue",
                "on-click-action": {
                  "name": "complete",
                  "payload": {
                    "bank_name": "${form.bank_name}",
                    "account_holder_name": "${form.account_holder_name}",
                    "account_number": "${form.account_number}",
                    "screen": "BANK_DETAILS"
                  }
                }
              }
            ]
          }
        ]
      }
    },
    {
      "id": "CONFIRM_SUBMIT",
      "title": "Confirm & Submit",
      "data": {
        "loan_summary": { "type": "string", "__example__": "R5,000 over 12 months" },
        "monthly_payment": { "type": "string", "__example__": "R458" },
        "bank_details": { "type": "string", "__example__": "Capitec - *****1234" }
      },
      "layout": {
        "type": "SingleColumnLayout",
        "children": [
          {
            "type": "Form",
            "name": "submit_form",
            "children": [
              {
                "type": "TextHeading",
                "text": "Ready to Submit?"
              },
              {
                "type": "TextBody",
                "text": "üìã Application Summary:"
              },
              {
                "type": "TextBody",
                "text": "Loan: ${data.loan_summary}"
              },
              {
                "type": "TextBody",
                "text": "Payment: ${data.monthly_payment}/month"
              },
              {
                "type": "TextBody",
                "text": "Account: ${data.bank_details}"
              },
              {
                "type": "OptIn",
                "name": "terms_agreement",
                "label": "I agree to the loan terms and conditions",
                "required": true
              },
              {
                "type": "OptIn",
                "name": "debit_order_consent",
                "label": "I authorize debit order for monthly payments",
                "required": true
              },
              {
                "type": "TextCaption",
                "text": "‚è±Ô∏è Processing typically takes 1-2 business days"
              },
              {
                "type": "Footer",
                "label": "Submit Application",
                "on-click-action": {
                  "name": "complete",
                  "payload": {
                    "terms_agreement": "${form.terms_agreement}",
                    "debit_order_consent": "${form.debit_order_consent}",
                    "screen": "CONFIRM_SUBMIT"
                  }
                }
              }
            ]
          }
        ]
      }
    },
    {
      "id": "SUCCESS",
      "title": "Application Submitted!",
      "terminal": true,
      "data": {
        "application_id": { "type": "string", "__example__": "LA-2026-0001" },
        "tracking_url": { "type": "string", "__example__": "https://hohemaweb-development.up.railway.app/loans" }
      },
      "layout": {
        "type": "SingleColumnLayout",
        "children": [
          {
            "type": "Form",
            "name": "success_form",
            "children": [
              {
                "type": "TextHeading",
                "text": "‚úÖ Application Submitted!"
              },
              {
                "type": "TextBody",
                "text": "Your loan application has been received and is being reviewed."
              },
              {
                "type": "TextBody",
                "text": "Application ID: ${data.application_id}"
              },
              {
                "type": "TextBody",
                "text": "üì± What happens next:"
              },
              {
                "type": "TextBody",
                "text": "1Ô∏è‚É£ We'll review your application (1-2 business days)"
              },
              {
                "type": "TextBody",
                "text": "2Ô∏è‚É£ You'll receive a WhatsApp notification of the decision"
              },
              {
                "type": "TextBody",
                "text": "3Ô∏è‚É£ If approved, funds will be disbursed to your account"
              },
              {
                "type": "EmbeddedLink",
                "text": "Track your application",
                "on-click-action": {
                  "name": "navigate",
                  "next": {
                    "type": "external_link",
                    "url": "${data.tracking_url}"
                  }
                }
              },
              {
                "type": "TextCaption",
                "text": "üí¨ Reply to this message anytime for assistance"
              },
              {
                "type": "Footer",
                "label": "Done",
                "on-click-action": {
                  "name": "complete",
                  "payload": {
                    "flow_completed": true,
                    "screen": "SUCCESS"
                  }
                }
              }
            ]
          }
        ]
      }
    }
  ]
}
